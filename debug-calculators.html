<!DOCTYPE html>
<html>
<head>
    <title>Calculator Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
        pre { background: #f5f5f5; padding: 10px; font-size: 12px; }
    </style>
</head>
<body>
    <h1>MLA Calculator Debug Test</h1>
    
    <div class="test-section">
        <h2>1. Script Loading Test</h2>
        <div id="script-test">Testing...</div>
    </div>
    
    <div class="test-section">
        <h2>2. Window Objects Test</h2>
        <div id="window-objects">Testing...</div>
    </div>
    
    <div class="test-section">
        <h2>3. Calculator Functions Test</h2>
        <div id="calculator-functions">Testing...</div>
    </div>
    
    <div class="test-section">
        <h2>4. Live BMI Calculator Test</h2>
        <input type="number" id="bmi-weight" placeholder="Weight (kg)" value="70">
        <input type="number" id="bmi-height" placeholder="Height (cm)" value="170">
        <select id="bmi-ethnicity">
            <option value="standard">Standard</option>
            <option value="asian">Asian</option>
        </select>
        <div>
            <label><input type="radio" name="bmi-sex" value="male" checked> Male</label>
            <label><input type="radio" name="bmi-sex" value="female"> Female</label>
        </div>
        <input type="number" id="bmi-waist" placeholder="Waist (cm)" value="85">
        <button onclick="testCalculate()">Test Calculate</button>
        <div id="bmi-result"></div>
    </div>

    <!-- Load required scripts in correct order -->
    <script src="/static/js/v2/extracted-calculators.js"></script>
    <script type="module" src="/static/js/v2/main.js"></script>
    
    <script>
        // Test functions
        function runTests() {
            console.log('=== Running Calculator Debug Tests ===');
            
            // Test 1: Script Loading
            testScriptLoading();
            
            // Test 2: Window Objects  
            setTimeout(testWindowObjects, 500);
            
            // Test 3: Calculator Functions
            setTimeout(testCalculatorFunctions, 1000);
        }
        
        function testScriptLoading() {
            const results = [];
            
            // Check if ExtractedCalculators loaded
            if (window.ExtractedCalculators) {
                results.push('<span class="success">✓ ExtractedCalculators loaded</span>');
                const getters = Object.keys(window.ExtractedCalculators).filter(k => k.startsWith('get') && k.includes('Calculator'));
                const calculators = Object.keys(window.ExtractedCalculators).filter(k => k.startsWith('calculate'));
                results.push(`<span class="success">✓ Found ${getters.length} calculator getters</span>`);
                results.push(`<span class="success">✓ Found ${calculators.length} calculation methods</span>`);
            } else {
                results.push('<span class="error">✗ ExtractedCalculators NOT loaded</span>');
            }
            
            document.getElementById('script-test').innerHTML = results.join('<br>');
        }
        
        function testWindowObjects() {
            const results = [];
            
            // Check window.quizApp
            if (window.quizApp) {
                results.push('<span class="success">✓ window.quizApp exists</span>');
                
                // Check if it has calculation methods
                const calcMethods = Object.keys(window.quizApp).filter(k => k.startsWith('calculate'));
                results.push(`<span class="success">✓ window.quizApp has ${calcMethods.length} calculation methods</span>`);
                
                // List some key methods
                const keyMethods = ['calculateBMI', 'calculateFrailty', 'calculateGCS', 'calculateWells'];
                keyMethods.forEach(method => {
                    if (window.quizApp[method]) {
                        results.push(`<span class="success">✓ ${method} available</span>`);
                    } else {
                        results.push(`<span class="error">✗ ${method} missing</span>`);
                    }
                });
                
            } else {
                results.push('<span class="error">✗ window.quizApp does NOT exist</span>');
            }
            
            // Check window.calculatorBridge
            if (window.calculatorBridge) {
                results.push('<span class="success">✓ window.calculatorBridge exists</span>');
            } else {
                results.push('<span class="warning">⚠ window.calculatorBridge missing</span>');
            }
            
            // Check window.MLAQuizApp
            if (window.MLAQuizApp) {
                results.push('<span class="success">✓ window.MLAQuizApp exists</span>');
            } else {
                results.push('<span class="warning">⚠ window.MLAQuizApp missing</span>');
            }
            
            document.getElementById('window-objects').innerHTML = results.join('<br>');
        }
        
        function testCalculatorFunctions() {
            const results = [];
            
            if (window.quizApp && window.quizApp.calculateBMI) {
                results.push('<span class="success">✓ calculateBMI function exists</span>');
                
                // Test function type
                if (typeof window.quizApp.calculateBMI === 'function') {
                    results.push('<span class="success">✓ calculateBMI is a function</span>');
                } else {
                    results.push('<span class="error">✗ calculateBMI is not a function</span>');
                }
                
            } else {
                results.push('<span class="error">✗ calculateBMI function missing</span>');
            }
            
            // Show all available calculation methods
            if (window.quizApp) {
                const allCalcMethods = Object.keys(window.quizApp).filter(k => k.startsWith('calculate'));
                results.push(`<pre>Available calculation methods:\n${allCalcMethods.join('\n')}</pre>`);
            }
            
            document.getElementById('calculator-functions').innerHTML = results.join('<br>');
        }
        
        function testCalculate() {
            console.log('Testing BMI calculation...');
            
            if (window.quizApp && window.quizApp.calculateBMI) {
                try {
                    window.quizApp.calculateBMI();
                    console.log('BMI calculation executed');
                } catch (error) {
                    console.error('BMI calculation error:', error);
                    document.getElementById('bmi-result').innerHTML = `<span class="error">Error: ${error.message}</span>`;
                }
            } else {
                document.getElementById('bmi-result').innerHTML = '<span class="error">calculateBMI function not available</span>';
            }
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, running tests in 2 seconds...');
            setTimeout(runTests, 2000);
        });
        
        // Also run tests periodically to catch async loading
        setInterval(() => {
            if (!window.quizApp) {
                setTimeout(runTests, 100);
            }
        }, 1000);
    </script>
</body>
</html>